@using System.Security.Claims
@inject IConfiguration Configuration

@{
    var userEmail = User.FindFirst(ClaimTypes.Email)?.Value;
    var userName = User.Identity?.Name;
    var userRole = User.FindFirst("Role")?.Value; // Custom claim
    var userIdClaim = User.FindFirst(ClaimTypes.NameIdentifier)?.Value;
    var adminEmail = Configuration["DefaultAdmin:Username"];

    bool isAdmin = !string.IsNullOrEmpty(userEmail) && userEmail.Equals(adminEmail, StringComparison.OrdinalIgnoreCase);
    int userId = 0;
    int.TryParse(userIdClaim, out userId);
}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <title>@ViewData["Title"] - ClinicSystem</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link rel="stylesheet" href="~/css/site.css" asp-append-version="true" />
    <link href="~/bs3/css/bootstrap.min.css" rel="stylesheet">
    <link href="~/js/jquery-ui/jquery-ui-1.10.1.custom.min.css" rel="stylesheet">
    <link href="~/css/bootstrap-reset.css" rel="stylesheet">
    <link href="~/font-awesome/css/font-awesome.css" rel="stylesheet">
    <link href="~/js/jvector-map/jquery-jvectormap-1.2.2.css" rel="stylesheet">
    <link href="~/css/clndr.css" rel="stylesheet">
    <link href="~/js/css3clock/css/style.css" rel="stylesheet">
    <link rel="stylesheet" href="~/lib/bootstrap/dist/css/bootstrap.min.css" />
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">

    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css">

    <style>
        /* Toàn bộ body và layout */
        body {
            min-height: 100vh;
            display: flex;
            flex-direction: row;
            margin: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        /* Sidebar chính */
        .sidebar {
            width: 260px;
            background-color: #f1f5f9; /* Màu nền nhạt */
            border-right: 1px solid #dee2e6;
            padding: 1.5rem 1rem;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            font-size: 18px;
        }



        /* Tiêu đề sidebar */
        .sidebar-title {
            font-size: 1.4rem;
            font-weight: bold;
            color: #1e3a8a; /* Xanh đậm */
            margin-bottom: 1rem;
        }

        /* Danh sách các link trong sidebar */
        .sidebar-link {
            display: block;
            color: #1f2937; /* text-slate-800 */
            padding: 0.6rem 0.8rem;
            margin-bottom: 0.4rem;
            border-radius: 6px;
            text-decoration: none;
            font-size: 1.07rem;
            transition: background-color 0.2s, color 0.2s;
        }

            /* Hover hiệu ứng */
            .sidebar-link:hover {
                background-color: #e0e7ff;
                color: #1d4ed8;
            }

            /* Link đang active */
            .sidebar-link.active {
                background-color: #c7d2fe;
                font-weight: 600;
                color: #1d4ed8;
            }

        /* Footer của sidebar chứa user info và logout */
        .sidebar-footer {
            margin-top: 2rem;
        }

        /* Phần thông tin user */
        .user-info {
            font-size: 0.95rem;
            color: #4b5563; /* text-gray-600 */
            margin-bottom: 0.5rem;
        }

        /* Link logout */
        .logout-link {
            font-weight: bold;
            color: #dc2626; /* đỏ nhạt */
        }

            /* Hover logout */
            .logout-link:hover {
                color: #b91c1c;
                text-decoration: underline;
            }

        /* Main content */
        .main-content {
            flex-grow: 1;
            padding: 2rem;
            background-color: #ffffff;
        }

    </style>
</head>
<body>
    <div class="sidebar d-flex flex-column justify-content-between">
        <div>
            <h4 class="sidebar-title">Clinic System</h4>

            <nav class="nav flex-column mt-4">
                @if (isAdmin)
                {
                    <a class="nav-link sidebar-link @(ViewContext.RouteData.Values["page"].ToString() == "/Admin/Dashboard" ? "active" : "")" asp-page="/Admin/Dashboard">Dashboard</a>
                    <a class="nav-link sidebar-link @(ViewContext.RouteData.Values["page"].ToString() == "/Users/Index" ? "active" : "")" asp-page="/Users/Index" asp-route-role="Patient">
                        Manage Users
                    </a>
                    <a class="nav-link sidebar-link @(ViewContext.RouteData.Values["page"].ToString() == "/DoctorLeafs/Index" ? "active" : "")" asp-page="/DoctorLeafs/Index">Manage Doctor Leaf</a>
                }
                else if (userRole == "Doctor")
                {
                    <a class="nav-link sidebar-link" asp-page="/Appointments/Index">Dashboard</a>
                    <a class="nav-link sidebar-link" asp-page="/DoctorLeafs/Index">Register Leave</a>
                    <a class="nav-link sidebar-link" asp-page="/Users/Edit" asp-route-id="@userId">My Profile</a>
                }
                else if (userRole == "Patient")
                {
                    <a class="nav-link sidebar-link" asp-page="/Appointments/Index">My Appointments</a>
                    <a class="nav-link sidebar-link" asp-page="/Users/Edit" asp-route-id="@userId">My Profile</a>
                }
            </nav>
        </div>

        <!-- Footer in Sidebar -->
        <div class="sidebar-footer mt-4">
            @if (!string.IsNullOrEmpty(userEmail))
            {
                <div class="user-info mb-2">
                    Hello, <strong>@userName</strong>
                </div>
                <a class="nav-link sidebar-link text-danger logout-link" asp-page="/Account/Logout">Logout</a>
            }
            else
            {
                <a class="nav-link sidebar-link text-primary" asp-page="/Account/Login">Login</a>
            }
        </div>
    </div>


    <!-- Main Content -->
    <div class="main-content">
        <main role="main" class="pb-3">
            @RenderBody()
        </main>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <script src="https://unpkg.com/htmx.org@2.0.4"></script>
    <script src="~/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>

    <script src="~/js/site.js" asp-append-version="true"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/microsoft-signalr/7.0.5/signalr.min.js"></script>

    <script src="~/js/jquery.js"></script>
    <script src="~/js/jquery-ui/jquery-ui-1.10.1.custom.min.js"></script>
    <script src="~/bs3/js/bootstrap.min.js"></script>
    <script src="~/js/jquery.dcjqaccordion.2.7.js"></script>
    <script src="~/js/jquery.scrollTo.min.js"></script>
    <script src="~/js/jQuery-slimScroll-1.3.0/jquery.slimscroll.js"></script>
    <script src="~/js/jquery.nicescroll.js"></script>
    <script src="~/js/skycons/skycons.js"></script>
    <script src="~/js/jquery.scrollTo/jquery.scrollTo.js"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery-easing/1.3/jquery.easing.min.js"></script>
    <script src="~/js/calendar/clndr.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="~/js/calendar/moment-2.2.1.js"></script>
    <script src="~/js/evnt.calendar.init.js"></script>
    <script src="~/js/jvector-map/jquery-jvectormap-1.2.2.min.js"></script>
    <script src="~/js/jvector-map/jquery-jvectormap-us-lcc-en.js"></script>
    @await RenderSectionAsync("Scripts", required: false)

</body>
</html>