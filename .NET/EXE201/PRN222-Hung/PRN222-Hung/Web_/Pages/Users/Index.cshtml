@page
@model Web_.Pages.Users.IndexModel

@{
    ViewData["Title"] = "User List";
    Layout = "_LayoutMain";
}

<head>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white d-flex justify-content-between align-items-center">
            <h4 class="mb-0"><i class="fa-solid fa-users me-2"></i> User List</h4>
            <a asp-page="Create" class="btn btn-light">
                <i class="fa-solid fa-plus me-1"></i> Create New
            </a>
        </div>

        <div class="card-body">
            <!-- Role Filter -->
            <div class="mb-3">
                <a asp-page="Index" asp-route-role="Patient"
                   class="btn btn-outline-primary @(Model.Role == "Patient" ? "active" : "")">
                    Patient
                </a>
                <a asp-page="Index" asp-route-role="Doctor"
                   class="btn btn-outline-primary @(Model.Role == "Doctor" ? "active" : "")">
                    Doctor
                </a>
            </div>

            <!-- Search Form -->
            <form method="get" class="row g-2 align-items-center mb-4">
                <input type="hidden" name="role" value="@Model.Role" />
                <div class="col-auto">
                    <input type="text" name="searchTerm" value="@Model.SearchTerm"
                           class="form-control" placeholder="Search..." />
                </div>
                <div class="col-auto">
                    <button type="submit" class="btn btn-primary">
                        <i class="fa fa-search me-1"></i> Search
                    </button>
                </div>
            </form>

            <!-- User Table -->
            <table class="table table-hover align-middle text-center">
                <thead class="table-light">
                    <tr>
                        <th>Avatar</th>
                        <th>Full Name</th>
                        <th>Phone Number</th>
                        <th>Email</th>
                        <th>Gender</th>
                        <th>Status</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.User)
                    {
                        <tr>
                            <td>
                                <img src="@(string.IsNullOrEmpty(item.Avatar) ? "/images/avatar1.jpg" : item.Avatar)"
                                     class="rounded-circle" style="width:45px; height:45px; object-fit:cover;" />
                            </td>
                            <td>@item.FullName</td>
                            <td>@item.PhoneNumber</td>
                            <td>@item.Email</td>
                            <td>@(item.Gender ? "Male" : "Female")</td>
                            <td>
                                <a href="#" class="toggle-status" data-id="@item.UserId" title="Click to toggle status">
                                    <i class="fa @(item.IsActive ? "fa-check-circle text-success" : "fa-times-circle text-danger") fa-lg"></i>
                                </a>
                            </td>
                            <td>
                                <a asp-page="./Edit" asp-route-id="@item.UserId" class="btn btn-warning me-2">
                                    <i class="fa-solid fa-pen-to-square me-1"></i> 
                                </a>
                                <a href="#" class="btn btn-danger delete-btn" data-id="@item.UserId">
                                    <i class="fa-solid fa-trash me-1"></i> 
                                </a>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>

            <!-- Pagination -->
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center">
                    <li class="page-item @(Model.CurrentPage == 1 ? "disabled" : "")">
                        <a class="page-link" asp-route-pageNumber="@(Model.CurrentPage - 1)"
                           asp-route-role="@Model.Role" asp-route-searchTerm="@Model.SearchTerm">
                            Previous
                        </a>
                    </li>
                    @for (int i = 1; i <= Model.TotalPages; i++)
                    {
                        <li class="page-item @(i == Model.CurrentPage ? "active" : "")">
                            <a class="page-link" asp-route-pageNumber="@i"
                               asp-route-role="@Model.Role" asp-route-searchTerm="@Model.SearchTerm">
                                @i
                            </a>
                        </li>
                    }
                    <li class="page-item @(Model.CurrentPage == Model.TotalPages ? "disabled" : "")">
                        <a class="page-link" asp-route-pageNumber="@(Model.CurrentPage + 1)"
                           asp-route-role="@Model.Role" asp-route-searchTerm="@Model.SearchTerm">
                            Next
                        </a>
                    </li>
                </ul>
            </nav>
        </div>
    </div>
</div>
<!-- Success/Failure Notifications -->
@if (TempData["SuccessMessage"] != null)
{
    <script>
        Swal.fire({
            icon: "success",
            title: "Success!",
            text: "@TempData["SuccessMessage"]"
        });
    </script>
}

@if (TempData["ErrorMessage"] != null)
{
    <script>
        Swal.fire({
            icon: "error",
            title: "Lỗi!",
            text: "@TempData["ErrorMessage"]"
        });
    </script>
}
@section Scripts {
    @{
        await Html.RenderPartialAsync("_ValidationScriptsPartial");
    }
    <script src="~/js/crud.js"></script>
    <script src="~/js/loading.js"></script>
    <script src="~/js/ckeditorBlog.js"></script>
    <script src="~/microsoft/signalr/dist/browser/signalr.js"></script>
    <script src="~/js/site.js"></script>


}